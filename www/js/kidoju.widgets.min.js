// Kidoju.Widgets 0.0.0 built on 03-11-2014 - Copyright ©2013-2014 Memba® Sarl. All rights reserved.

!function(a,b){"use strict";function c(a){return function(b){return b=a(b),b||[]}}function d(a){return function(b){return b&&("[object Array]"===toString.call(b)||b instanceof g.data.ObservableArray||(b=[b])),b=a(b),b||[]}}var e=Function,f=e("return this")(),g=f.kendo,h=g.data,i=f.kidoju=f.kidoju||{},j="string",k="number",l="change",m="error",n="00000000-0000-0000-0000-000000000000",o=0,p=-1,q=i.PageItem=h.Model.define({id:"id",fields:{id:{type:j,defaultValue:n,editable:!1},tool:{type:j,editable:!1},top:{type:k,defaultValue:o},left:{type:k,defaultValue:o},height:{type:k,defaultValue:p},width:{type:k,defaultValue:p},rotate:{type:k,defaultValue:o,parse:function(a){return(a+360)%360}},tag:{type:j,defaultValue:null},attributes:{type:j,defaultValue:JSON.stringify({}),parse:function(a){try{return JSON.parse(a),a}catch(b){return JSON.stringify({})}}},properties:{type:j,defaultValue:JSON.stringify({}),parse:function(a){try{return JSON.parse(a),a}catch(b){return JSON.stringify({})}}}},init:function(c){var d=this;g.data.Model.fn.init.call(d,b);for(var e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);if(i.tools&&a.type(d.tool)===j){var f=i.tools[d.tool];if(f instanceof i.Tool){var h=f._initAttributes();try{a.extend(h,JSON.parse(d.attributes))}catch(k){}d.attributes=JSON.stringify(h);var l=f._initProperties();try{a.extend(l,JSON.parse(d.properties))}catch(k){}d.properties=JSON.stringify(l)}}},update:function(a){for(var b in a)this.set(b,a[b])},attr:function(a,c){var d=this.getAttributes();return c===b?d[a]:(d[a]=c,void this.set("attributes",JSON.stringify(d)))},getAttributes:function(){var b=this.get("attributes");return a.type(b)===j?JSON.parse(b):{}},prop:function(a,c){var d=this.getProperties();return c===b?d[a]:(d[a]=c,void this.set("properties",JSON.stringify(d)))},getProperties:function(){var b=this.get("properties");return a.type(b)===j?JSON.parse(b):{}}}),r=g.Class.extend({init:function(b,e){this.reader=e,e.model&&(this.model=e.model),this.data=c(a.proxy(this.data,this)),this.serialize=d(a.proxy(this.serialize,this))},errors:function(a){return this.reader.errors(a)},parse:function(a){return this.reader.parse(a)},data:function(a){return this.reader.data(a)},total:function(a){return this.reader.total(a)},groups:function(a){return this.reader.groups(a)},aggregates:function(a){return this.reader.aggregates(a)},serialize:function(a){return this.reader.serialize(a)}}),s=i.PageItemCollectionDataSource=h.DataSource.extend({init:function(b){h.DataSource.fn.init.call(this,a.extend(!0,{},{schema:{modelBase:q,model:q}},b)),this.reader=new r(this.options.schema,this.reader)},insert:function(a,b){if(b){if(!(b instanceof q)){var c=b;b=this._createNewModel(),b.accept(c)}return h.DataSource.fn.insert.call(this,a,b)}},remove:function(a){return h.DataSource.fn.remove.call(this,a)}});s.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof s)&&b instanceof g.data.DataSource)throw new Error("Incorrect DataSource type. Only PageItemCollectionDataSource instances are supported");return b instanceof s?b:new s(b)};var t=i.Page=h.Model.define({id:"id",fields:{id:{type:j,defaultValue:n,editable:!1}},init:function(a){var b=this;g.data.Model.fn.init.call(b,a),b._itemsOptions={data:b.items,schema:{modelBase:q,model:q}},b._initItems(),b._loaded=!(!a||!a.items&&!a._loaded)},_initItems:function(){var a,b,c,d=this;d.items instanceof s||(a=d.items=new s(d._itemsOptions),b=a.transport,c=b.parameterMap,b.parameterMap=function(a){return a[d.idField||"id"]=d.id,c&&(a=c(a)),a},a.parent=function(){return d},a.bind(l,function(a){a.node=a.node||d,d.trigger(l,a)}),a.bind(m,function(a){var b=d.parent();b&&(a.node=a.node||d,b.trigger(m,a))}))},append:function(a){this._initItems(),this.loaded(!0),this.items.add(a)},_itemsLoaded:function(){this._loaded=!0},load:function(){var c,d={},e="_query";this._initItems(),c=this.items,d[this.idField||"id"]=this.id,this._loaded||(c._data=b,e="read"),c.one(l,a.proxy(this._itemsLoaded,this)),c[e](d)},loaded:function(a){return a===b?this._loaded:void(this._loaded=a)},shouldSerialize:function(a){return Model.fn.shouldSerialize.call(this,a)&&"items"!==a&&"_loaded"!==a&&"_itemsOptions"!==a}}),u=g.Class.extend({init:function(b,e){this.reader=e,e.model&&(this.model=e.model),this.data=c(a.proxy(this.data,this)),this.serialize=d(a.proxy(this.serialize,this))},errors:function(a){return this.reader.errors(a)},parse:function(a){return this.reader.parse(a)},data:function(a){return this.reader.data(a)},total:function(a){return this.reader.total(a)},groups:function(a){return this.reader.groups(a)},aggregates:function(a){return this.reader.aggregates(a)},serialize:function(a){return this.reader.serialize(a)}}),v=i.PageCollectionDataSource=h.DataSource.extend({init:function(b){h.DataSource.fn.init.call(this,a.extend(!0,{},{schema:{modelBase:t,model:t}},b)),this.reader=new u(this.options.schema,this.reader)},insert:function(a,b){if(b){if(!(b instanceof t)){var c=b;b=this._createNewModel(),b.accept(c)}return h.DataSource.fn.insert.call(this,a,b)}},remove:function(a){return h.DataSource.fn.remove.call(this,a)},getObjectFromProperties:function(){for(var a={},b=this.data(),c=0;c<b.length;c++){b[c].load();for(var d=b[c].items.data(),e=0;e<d.length;e++){var f=d[e].getProperties()||{};for(var h in f)f.hasOwnProperty(h)&&(a[f[h].name]=f[h].value)}}return g.observable(a)}});v.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof v)&&b instanceof g.data.DataSource)throw new Error("Incorrect DataSource type. Only PageCollectionDataSource instances are supported");return b instanceof v?b:new v(b)}}(jQuery),function(a,b){"use strict";function c(b,c){var d=c.split(",");return parseInt(d[0])+W+","+(parseInt(d[1])-a(b).height())+W}var d=Function,e=d("return this")(),f=e.kendo,g=e.kidoju=e.kidoju||{},h="object",i="string",j="number",k="default",l="crosshair",m="pointer",n="click",o="draggable",p="dragstart",q="dragenter",r="dragover",s="drop",t=20,u='<div data-id="{0}" data-tool="{1}" class="kj-element"></div>',v="kj-element",w='.kj-element[data-id="{0}"]',x="data-id",y="data-tool",z="data-element",A='<div class="kj-handler"></div>',B=".kj-handler",C='<span class="kj-handler-button kj-drag-button"></span>',D=".kj-drag-button",E='<span class="kj-handler-button kj-resize-button"></span>',F=".kj-resize-button",G='<span class="kj-handler-button kj-rotate-button"></span>',H=".kj-rotate-button",I='<span class="kj-handler-button kj-menu-button"></span>',J=".kj-menu-button",K="position",L="absolute",M="display",N="none",O="block",P="height",Q="width",R="margin",S="padding",T="resize",U="translate",V="rotate",W="px",X=!1,Y="kidoju.tools: ";g.tools=f.observable({active:null,register:function(b){if(a.type(b.fn)===h){var c=new b;if(c instanceof Z&&a.type(c.id)===i){if("active"===c.id)throw new Error("You cannot name your tool [active]");this[c.id]||(this[c.id]=c,c.id===m&&(this.active=m))}}}});var Z=g.Tool=f.Class.extend({id:null,icon:null,cursor:null,height:250,width:250,playBar:[],designBar:[],attributes:{},properties:{},init:function(b){a.type(b)===h&&(a.type(b.id)===i&&(this.id=b.id),a.type(b.icon)===i&&(this.icon=b.icon),a.type(b.cursor)===i&&(this.cursor=b.cursor),a.type(b.height)===j&&(this.height=b.height),a.type(b.width)===j&&(this.width=b.width))},_initAttributes:function(){var a={};for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&this.attributes[b]instanceof $.AttributeAdapter&&(a[b]=this.attributes[b].value);return a},_initProperties:function(){var a={};for(var b in this.properties)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof $.PropertyAdapter&&(a[b]={name:this.properties[b].getName(),value:this.properties[b].getValue()});return a},_getElementWrapper:function(b){var c=this,d=a(f.format(u,b.id,b.tool)).css(K,L).css(P,b.height+W).css(Q,b.width+W).css({translate:[b.left,b.top],rotate:b.rotate}).on(n,c.onClick).on(U,c.onTranslate).on(T,c.onResize).on(V,c.onRotate);return d},_prepareHandler:function(b){var d=this;if(0===a(b).find(B).length){var g=a(A).css(K,L).css(M,N).append(C).append(E).append(G).append(I).on(q,function(a){a.preventDefault(),a.stopPropagation()}).on(r,function(e){if(a.isPlainObject(d._transform)&&a.type(d._transform.id)===i){var g=a(b).find(B),h=a(b).find(f.format(w,d._transform.id));if(d._transform.type===U){var j={left:d._transform.offset.x+e.originalEvent.clientX,top:d._transform.offset.y+e.originalEvent.clientY},k=j.left+W+","+j.top+W;g.css(U,c(b,k)),h.css(U,k).trigger(U,j)}else if(d._transform.type===T){var l={width:d._transform.offset.x+e.originalEvent.clientX,height:d._transform.offset.y+e.originalEvent.clientY};g.width(l.width).height(l.height),h.width(l.width).height(l.height).trigger(T,l)}else if(d._transform.type===V){var m=180*(d._transform.rotate-d._transform.offset+Math.atan2(e.originalEvent.clientY-d._transform.origin.y,e.originalEvent.clientX-d._transform.origin.x))/Math.PI;g.css(V,m+"deg"),h.css(V,m+"deg").trigger(V,m)}}e.preventDefault(),e.stopPropagation()}).on(s,function(a){delete d._transform,a.preventDefault(),a.stopPropagation()});g.find(D).prop(o,!0).on(p,function(c){var e=a(c.currentTarget).closest(B).attr(z);if(a.type(e)===i){var g=a(b).find(f.format(w,e)),h=g.css(U).split(",");d._transform={type:U,id:e,offset:{x:parseInt(h[0])-c.originalEvent.clientX,y:parseInt(h[1])-c.originalEvent.clientY}}}}),g.find(F).prop(o,!0).on(p,function(c){var e=a(c.currentTarget).closest(B).attr(z);if(a.type(e)===i){var g=a(b).find(f.format(w,e));d._transform={type:T,id:e,offset:{x:g.width()-c.originalEvent.clientX,y:g.height()-c.originalEvent.clientY}}}}),g.find(H).prop(o,!0).on(p,function(c){var e=a(c.currentTarget).closest(B).attr(z);if(a.type(e)===i){var g=a(b).find(f.format(w,e)),h=parseInt(g.css(V))*Math.PI/180,j=(g.position().left+g.width()*Math.cos(h)+g.height()*Math.sin(h))/2,k=(g.position().top+g.width()*Math.sin(h)+g.height()*Math.cos(h))/2;d._transform={type:V,id:e,origin:{x:j,y:k},rotate:h,offset:Math.atan2(c.originalEvent.clientY-k,c.originalEvent.clientX-j)}}}),g.find(J).on(n,function(a){X&&e.console&&e.console.log(Y+"click on handler menu"),a.preventDefault(),a.stopPropagation()}),a(b).append(g)}},_showHandler:function(b,d){var e=a(b).find(f.format(w,d));a(b).find(B).css(P,e.css(P)).css(Q,e.css(Q)).css(S,t+W).css(R,"-"+t+W).css(U,c(b,e.css(U))).css(V,e.css(V)).css(M,O).attr(z,d)},_hasHandler:function(b,c){return a(b).find(B).attr(z)===c},_hideHandler:function(b){a(b).find(B).css(M,N).removeAttr(z)},_draw:function(b,c){X&&e.console&&e.console.log(Y+"drawing "+c.tool+" "+c.id);var d=this._getElementWrapper(c),f=this.getHtml(c);return d.append(f),a(b).append(d),d.trigger(T,{height:c.height,width:c.width}),d},_updateContent:function(){},_removeContent:function(){},getHtml:function(){return""},onClick:function(b){var c=a(b.currentTarget);if(c.hasClass(v)){var d=c.closest(f.roleSelector("page")),h=d.data("kendoPage"),j=c.attr(x),k=c.attr(y);if(a.type(j)===i){X&&e.console&&e.console.log(Y+"click on "+j);var l=g.tools[k];l instanceof g.Tool&&h.mode()===h.modes.design&&(l._prepareHandler(d),l._showHandler(d,j)),b.preventDefault(),b.stopPropagation()}}},onResize:function(){a.noop()}}),$=g.adapters=g.adapters||{},_=$.AttributeAdapter=f.Class.extend({value:b,init:function(a){this.value=a},getEditor:function(){return""}}),ab=($.TextAttributeAdapter=_.extend({init:function(a){this.value=a},getEditor:function(){return""}}),$.IntegerAttributeAdapter=_.extend({value:0,init:function(a){this.value=a},getEditor:function(){return""}}),$.BooleanAttributeAdapter=_.extend({value:!1,init:function(a){this.value=a},getEditor:function(){return""}}),$.FontAttributeAdapter=_.extend({}),$.ColorAttributeAdapter=_.extend({value:!1,init:function(a){this.value=a},getEditor:function(){return""}}),$.PropertyAdapter=f.Class.extend({_prefix:"prop",value:b,init:function(){a.noop()},getName:function(){for(var a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",b=this._prefix,c=0;4>c;c++)b+=a.charAt(Math.floor(a.length*Math.random()));return b},getValue:function(){return this.value}})),bb=($.TextPropertyAdapter=ab.extend({_prefix:"textbox_"}),g.Tool.extend({id:m,icon:"mouse_pointer",cursor:k}));g.tools.register(bb);var cb=g.Tool.extend({id:"label",icon:"document_orientation_landscape",cursor:l,templates:{"default":'<span style="font-family: #= attributes.font #; color: #= attributes.color#;">#= attributes.text#</span>'},height:100,width:300,attributes:{text:new $.TextAttributeAdapter("Label"),font:new $.TextAttributeAdapter("Georgia, serif"),color:new $.TextAttributeAdapter("#FF0000")},getHtml:function(a){var b=f.template(this.templates.default),c={attributes:a.getAttributes(),properties:a.getProperties()};return b(c)},onResize:function(b,c){var d=a(b.currentTarget);if(d.hasClass(v)){var e=d.find(">span");if(a.isPlainObject(c)){a.type(c.width)===j&&e.width(c.width),a.type(c.height)===j&&e.height(c.height);var f=parseInt(e.css("font-size")),g=e.clone().hide().css(K,L).css("height","auto").width(c.width);for(d.after(g);g.height()<c.height;)f++,g.css("font-size",f+W);for(;g.height()>c.height;)f--,g.css("font-size",f+W);g.remove(),e.css("font-size",f+W)}b.preventDefault(),b.stopPropagation()}}});g.tools.register(cb);var db=g.Tool.extend({id:"image",icon:"painting_landscape",cursor:l,templates:{"default":'<img src="#= attributes.src #" alt="#= attributes.alt #">'},height:250,width:250,attributes:{src:new $.TextAttributeAdapter(""),alt:new $.TextAttributeAdapter("")},getHtml:function(a){var b=f.template(this.templates.default),c={attributes:a.getAttributes(),properties:a.getProperties()};return b(c)},onResize:function(b,c){var d=a(b.currentTarget);if(d.hasClass(v)){var e=d.find(">img");a.isPlainObject(c)&&(a.type(c.width)===j&&e.width(c.width),a.type(c.height)===j&&e.height(c.height)),b.preventDefault(),b.stopPropagation()}}});g.tools.register(db);var eb=g.Tool.extend({id:"textbox",icon:"text_field",cursor:l,templates:{"default":'<input type="text" data-bind="value: #= properties.text.name #">'},height:100,width:300,properties:{text:new $.TextPropertyAdapter},getHtml:function(a){var b=f.template(this.templates.default),c={attributes:a.getAttributes(),properties:a.getProperties()};return b(c)},onResize:function(b,c){var d=a(b.currentTarget);if(d.hasClass(v)){var e=d.find(">input");a.isPlainObject(c)&&(a.type(c.width)===j&&e.width(c.width),a.type(c.height)===j&&(e.height(c.height),e.css("font-size",Math.floor(.75*c.height)))),b.preventDefault(),b.stopPropagation()}}});g.tools.register(eb);var fb=g.Tool.extend({id:"button",icon:"button",cursor:l,templates:{"default":'<button type="button">#= attributes.text #</button>'},height:100,width:300,attributes:{text:new $.TextAttributeAdapter("Button")},getHtml:function(a){var b=f.template(this.templates.default),c={attributes:a.getAttributes(),properties:a.getProperties()};return b(c)},addEvents:function(){},removeEvents:function(){},onResize:function(b,c){var d=a(b.currentTarget);if(d.hasClass(v)){var e=d.find(">button");a.isPlainObject(c)&&(a.type(c.width)===j&&e.width(c.width),a.type(c.height)===j&&(e.height(c.height),e.css("font-size",Math.floor(.75*c.height)))),b.preventDefault(),b.stopPropagation()}}});g.tools.register(fb)}(jQuery),function(a){"use strict";function b(b){return a.type(b)===i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)}var c=Function,d=c("return this")(),e=d.kendo,f=e.data,g=f.binders,h=f.Binder,i=(e.ui,"string"),j="number",k="change";g.widget.index=h.extend({init:function(b,c,d){h.fn.init.call(this,b.element[0],c,d),this.widget=b,this._change=a.proxy(this.change,this),this.widget.bind(k,this._change)},change:function(){this.bindings.index.set(this.widget.index())},refresh:function(){var b=this.bindings.index.get();a.type(b)===j&&this.widget.index(b)},destroy:function(){this.widget.unbind(k,this._change)}}),g.widget.id=h.extend({init:function(b,c,d){h.fn.init.call(this,b.element[0],c,d),this.widget=b,this._change=a.proxy(this.change,this),this.widget.bind(k,this._change)},change:function(){this.bindings.id.set(this.widget.id())},refresh:function(){var a=this.bindings.id.get();b(a)&&this.widget.id(a)},destroy:function(){this.widget.unbind(k,this._change)}}),g.widget.selection=h.extend({init:function(b,c,d){h.fn.init.call(this,b.element[0],c,d),this.widget=b,this._change=a.proxy(this.change,this),this.widget.bind(k,this._change)},change:function(){this.bindings.selection.set(this.widget.selection())},refresh:function(){this.widget.selection(this.bindings.selection.get())},destroy:function(){this.widget.unbind(k,this._change)}}),g.widget.properties=h.extend({init:function(b,c,d){h.fn.init.call(this,b.element[0],c,d),this.widget=b,this._change=a.proxy(this.change,this),this.widget.bind(k,this._change)},change:function(){this.bindings.properties.set(this.widget.properties())},refresh:function(){this.widget.properties(this.bindings.properties.get())},destroy:function(){this.widget.unbind(k,this._change)}})}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=(d.data,d.ui.Widget),f="k-widget kj-explorer",g=!1,h="kidoju.widgets.designbar: ",i=e.extend({init:function(a,b){var d=this;e.fn.init.call(this,a,b),g&&c.console&&c.console.log(h+"widget initialized"),d._layout()},options:{name:"Designbar"},_layout:function(){var b=this;a(b.element).html(b.options.name)},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off().empty().removeClass(f)},destroy:function(){var a=this;e.fn.destroy.call(a),a._clear(),d.destroy(a.element)}});d.ui.plugin(i)}(jQuery),function(a,b){"use strict";function c(b){return a.type(b)===h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)}var d=Function,e=d("return this")(),f=e.kendo,g=(f.data,f.ui.Widget),h="string",i="number",j=null,k="change",l="click",m="mouseenter",n="mouseleave",o=".kendoExplorer",p="k-widget k-group kj-explorer",q="k-state-hover",r="k-state-selected",s="li.k-item[data-uid]",t='li.k-item[data-uid="{0}"]',u="aria-selected",v=!1,w="kidoju.widgets.explorer: ",x=g.extend({init:function(a,b){var c=this;g.fn.init.call(this,a,b),v&&e.console&&e.console.log(w+"widget initialized"),c._templates(),c._layout(),c._dataSource()},options:{name:"Explorer",index:0,id:null,autoBind:!0,itemTemplate:'<li data-uid="#= uid #" tabindex="-1" unselectable="on" role="option" class="k-item kj-explorer-item"><span class="k-in"><img class="k-image kj-explorer-icon" alt="#= tool #" src="#= icon #">#= tool #</span></li>',iconPath:"./styles/images/toolbox/",messages:{empty:"No item to display"}},setOptions:function(a){g.fn.setOptions.call(this,a)},events:[k],index:function(c){var d,f=this;if(c===b)return d=f.dataSource.getByUid(f._selectedUid),d instanceof kidoju.PageItem?f.dataSource.indexOf(d):-1;if(v&&e.console&&e.console.log(w+"index set to "+c),a.type(c)!==i)throw new TypeError;if(0>c||c>0&&c>=f.length())throw new RangeError;d=f.dataSource.at(c),f.selection(d)},id:function(a){var d,e=this;if(a===b)return d=e.dataSource.getByUid(e._selectedUid),d instanceof kidoju.PageItem?d[d.idField]:b;if(!c(a))throw new TypeError;d=e.dataSource.get(a),e.selection(d)},selection:function(d){var e=this;if(d===b)return e.dataSource.getByUid(e._selectedUid);if(!(d instanceof kidoju.PageItem))throw new TypeError;if(c(e._selectedUid)||0!==e.length()){if(d.uid!==e._selectedUid){var f=e.dataSource.indexOf(d);if(f>=0){e._selectedUid=d.uid;var g=a.Event(k,{index:f,id:d[d.idField],value:d});e.refresh(g),e.trigger(k,g)}}}else e._tmp=d},length:function(){return this.dataSource instanceof kidoju.PageItemCollectionDataSource?this.dataSource.total():0},items:function(){return this.list[0].children},_templates:function(){var a=this;a.itemTemplate=f.template(a.options.itemTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof kidoju.PageItemCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(k,b._refreshHandler),b.options.dataSource!==j&&(b.dataSource=kidoju.PageItemCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(k,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this,c=b.element;b.list=c.find("ul.k-list"),b.list.length||(b.list=a('<ul tabindex="-1" unselectable="on" role="listbox" class="k-list k-reset" />').appendTo(c)),c.on(m+o+" "+n+o,s,b._toggleHover).on(l+o,s,a.proxy(b._click,b)).addClass(p),f.notify(b)},refresh:function(a){var c=this,d="";if(!a||"itemchange"!==a.action){if(a===b||a.type!==k){var e=[];a===b&&c.dataSource instanceof kidoju.PageItemCollectionDataSource?e=c.dataSource.data():a&&a.items instanceof f.data.ObservableArray&&(e=a.items);for(var g=0;g<e.length;g++){var h=kidoju.tools[e[g].tool];h instanceof kidoju.Tool&&(d+=c.itemTemplate({uid:e[g].uid,tool:e[g].tool,icon:c.options.iconPath+h.icon+".svg"}))}d.length>0&&c._tmp instanceof kidoju.PageItem?(c.selection(c._tmp),delete c._tmp):0===d.length&&(d=c.options.messages.empty),c.list.html(d)}c.list.find(s).removeClass(r).removeProp(u),c.list.find(f.format(t,c._selectedUid)).addClass(r).prop(u,!0)}},_toggleHover:function(b){a(b.currentTarget).toggleClass(q,b.type===m)},_click:function(b){var c=a(b.currentTarget);if(b.preventDefault(),!c.is("."+r)){var d=this.dataSource.getByUid(c.attr(f.attr("uid")));this.selection(d)}},_clear:function(){var a=this,b=a.element;f.unbind(b),b.find("*").off(),b.off(o).empty().removeClass(p)},destroy:function(){var a=this;g.fn.destroy.call(a),a._clear(),a.setDataSource(j),f.destroy(a.element)}});f.ui.plugin(x)}(jQuery),function(a,b){"use strict";function c(b){return a.type(b)===j&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)}var d=Function,e=d("return this")(),f=e.kendo,g=(f.data,f.ui.Widget),h=null,i="number",j="string",k="change",l="click",m="mouseenter",n="mouseleave",o=".kendoNavigation",p="k-widget k-group kj-navigation",q="k-state-selected",r=".kj-navigation-page[data-uid]",s='.kj-navigation-page[data-uid="{0}"]',t="aria-selected",u=20,v=!1,w="kidoju.widgets.navigation: ",x=g.extend({init:function(a,b){var c=this;g.fn.init.call(this,a,b),v&&e.console&&e.console.log(w+"widget initialized"),c._templates(),c._layout(),c._dataSource()},options:{name:"Navigation",autoBind:!0,itemTemplate:'<div data-uid="#= uid #" class="kj-navigation-page" role="option" aria-selected="false"><div data-role="page"></div></div>',addTemplate:'<div data-uid="#= uid #" class="kj-navigation-page" role="option" aria-selected="false"><div>#= text #</div></div>',pageWidth:1024,pageHeight:768,selectionBorder:10,pageSpacing:20,messages:{newPage:"New Page"}},index:function(c){var d,f=this;if(c===b)return d=f.dataSource.getByUid(f._selectedUid),d instanceof kidoju.Page?f.dataSource.indexOf(d):-1;if(v&&e.console&&e.console.log(w+"index set to "+c),a.type(c)!==i)throw new TypeError;if(0>c||c>0&&c>=f.length())throw new RangeError;d=f.dataSource.at(c),f.selection(d)},id:function(a){var d,e=this;if(a===b)return d=e.dataSource.getByUid(e._selectedUid),d instanceof kidoju.Page?d[d.idField]:b;if(!c(a))throw new TypeError;d=e.dataSource.get(a),e.selection(d)},selection:function(d){var e=this;if(d===b)return e.dataSource.getByUid(e._selectedUid);if(!(d instanceof kidoju.Page))throw new TypeError;if(c(e._selectedUid)||0!==e.length()){if(d.uid!==e._selectedUid){var f=e.dataSource.indexOf(d);if(f>=0){e._selectedUid=d.uid;var g=a.Event(k,{index:f,id:d[d.idField],value:d});e.refresh(g),e.trigger(k,g)}}}else e._tmp=d},length:function(){return this.dataSource instanceof kidoju.PageCollectionDataSource?this.dataSource.total():0},height:function(b){var c=this;if(!b)return c.options.height;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.height&&(c.options.height=b)},width:function(b){var c=this;if(!b)return c.options.width;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.width&&(c.options.width=b)},_templates:function(){this.itemTemplate=f.template(this.options.itemTemplate),this.addTemplate=f.template(this.options.addTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof kidoju.PageCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(k,b._refreshHandler),b.options.dataSource!==h&&(b.dataSource=kidoju.PageCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(k,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this;b.element.addClass(p).attr("role","listbox").on(l+o,r,a.proxy(b._clickHandler,b)).on(m+o+" "+n+o,r,b._toggleHover)},refresh:function(c){var d=this,e=d.element,g=(e.width()-u-2*parseInt(d.options.pageSpacing))/d.options.pageWidth;if(c===b||c.action===b){var h=[];c===b&&d.dataSource instanceof kidoju.PageCollectionDataSource?h=d.dataSource.data():c.items&&(h=c.items);for(var i=0;i<h.length;i++)h[i]instanceof kidoju.Page&&(e.find(f.format(s,h[i].uid)).length||a(d.itemTemplate({uid:h[i].uid})).css("box-sizing","border-box").css("position","relative").css("padding",parseInt(d.options.selectionBorder)).css("margin",parseInt(d.options.pageSpacing)-parseInt(d.options.selectionBorder)).append('<div style="position:absolute; top: 10px; left: 10px; height: 20px; width: 20px; background-color: black;"></div>').appendTo(e).find(f.roleSelector("page")).kendoPage({mode:f.ui.Page.fn.modes.thumbnail,dataSource:h[i].items,scale:g}))}d.displaySelection(),d.resize()},displaySelection:function(){var a=this,b=a.element;b.find(r).removeClass(q).removeProp(t),b.find(f.format(s,a._selectedUid)).addClass(q).prop(t,!0)},resize:function(){var b=this,c=b.element,d=(c.width()-2*parseInt(b.options.pageSpacing))/b.options.pageWidth;c.find(r).width(d*parseInt(b.options.pageWidth)).height(d*parseInt(b.options.pageHeight));for(var e=c.find(f.roleSelector("page")),g=0;g<e.length;g++)a(e[g]).data("kendoPage").scale(d)},_toggleHover:function(b){if(b instanceof a.Event){var c=a(b.currentTarget);c.toggleClass("k-state-hover",b.type===m)}},_clickHandler:function(b){if(b instanceof a.Event){{var c=a(b.currentTarget);c.closest(f.roleSelector("navigation"))}if(b.preventDefault(),!c.is("."+q)){var d=this.dataSource.getByUid(c.attr(f.attr("uid")));this.selection(d)}}},_clear:function(){var a=this;f.unbind(a.element),a.element.find("*").off(),a.element.off().empty().removeClass(p)},destroy:function(){var a=this;g.fn.destroy.call(a),a._clear(),a.setDataSource(h),f.destroy(a.element)}});f.ui.plugin(x)}(jQuery),function(a,b){"use strict";var c=Function,d=c("return this")(),e=d.kendo,f=e.ui.Widget,g=d.kidoju,h="string",i="number",j=null,k="click",l="change",m="translate",n="resize",o="rotate",p="position",q="relative",r="top",s="left",t="height",u="width",v=1,w=1024,x=768,y={THUMBNAIL:"thumbnail",DESIGN:"design",SOLUTION:"solution",LEARN:"learn",ASSESS:"assess"},z="pointer",A="k-widget kj-page",B='.kj-element[data-id="{0}"]',C='<div class="kj-container"></div>',D=!1,E="kidoju.widgets.page: ",F=f.extend({init:function(a,b){var c=this;f.fn.init.call(c,a,b),D&&d.console&&d.console.log(E+"widget initialized"),c.setOptions(b),c._layout(),c._dataSource()},modes:{thumbnail:y.THUMBNAIL,design:y.DESIGN,solution:y.SOLUTION,learn:y.LEARN,assess:y.ASSESS},options:{name:"Page",autoBind:!0,mode:y.ASSESS,scale:v,height:x,width:w,tools:g.tools,dataSource:b},setOptions:function(a){f.fn.setOptions.call(this,a),this._mode=this.options.mode,this._scale=this.options.scale,this._height=this.options.height,this._width=this.options.width},mode:function(c){var d=this;if(c===b)return d._mode;if(a.type(c)!==h)throw new TypeError;c!==d._mode&&(d._mode=c,d.refresh())},scale:function(c){var f=this;if(c===b)return f._scale;if(a.type(c)!==i)throw new TypeError;if(0>c)throw new RangeError;c!==f._scale&&(f._scale=c,D&&d.console&&d.console.log(E+"scale changed to: "+f._scale),f.element.css({transformOrigin:"0px 0px"}).css({transform:e.format("scale({0})",f._scale)}))},height:function(b){var c=this;if(!b)return c.options.height;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.height&&(c.options.height=b)},width:function(b){var c=this;if(!b)return c.options.width;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.width&&(c.options.width=b)},properties:function(a){var b=this;return a?void(a!==b._properties&&(b._properties=a)):b._properties},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof g.PageItemCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(l,b._refreshHandler),b.options.dataSource!==j&&(b.dataSource=g.PageItemCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(l,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this;b._clear(),b._container=a(C).css(p,q).css(t,b.height()+"px").css(u,b.width()+"px"),b.element.addClass(A).css(p,q).css("overflow","hidden").css(t,b.height()+"px").css(u,b.width()+"px").css({transformOrigin:"0px 0px"}).css({transform:e.format("scale({0})",b._scale)}).append(b._container),b.mode()===b.modes.design&&b._container.on(k,function(c){D&&d.console&&d.console.log(E+"page clicked at ("+c.offsetX+","+c.offsetY+")");var f=b.options.tools.get("active"),h=b.options.tools[f];if(f!==z){var i=new g.PageItem({id:e.guid(),tool:f,left:c.offsetX,top:c.offsetY,width:h.width,height:h.height});b.dataSource.add(i),b.options.tools.set("active",z)}else a.isFunction(h._hideHandler)&&h._hideHandler(b.element)})},_addPageElement:function(b,c,d){var f=this;if(b instanceof g.PageItem){var h=f.options.tools[b.tool];if(h instanceof g.Tool){a.type(c)===i&&b.set(s,c),a.type(d)===i&&b.set(r,d);var j=h._draw(f._container,b);j.on(m,function(b,c){var d=a(b.currentTarget),f=d.closest(e.roleSelector("page")),g=f.data("kendoPage"),h=d.data("id"),i=g.dataSource.get(h);i.set(r,c.top),i.set(s,c.left)}).on(n,function(b,c){var d=a(b.currentTarget),f=d.closest(e.roleSelector("page")),g=f.data("kendoPage"),h=d.data("id"),i=g.dataSource.get(h);i.set(t,c.height),i.set(u,c.width)}).on(o,function(b,c){var d=a(b.currentTarget),f=d.closest(e.roleSelector("page")),g=f.data("kendoPage"),h=d.data("id"),i=g.dataSource.get(h);i.set(o,c)})}}},_removePageElement:function(a){var b=this;b._container.find(e.format(B,a)).off().remove()},refresh:function(a){var c=this,d=0;if(a===b||a.action===b){var f=[];for(a===b&&c.dataSource instanceof e.data.PageItemCollectionDataSource?f=c.dataSource.data():a&&a.items instanceof e.data.ObservableArray&&(f=a.items),c.mode()===c.modes.assess&&e.unbind(c._container,c.properties()),c._container.find("*").off(),c._container.empty(),d=0;d<f.length;d++){var h=f[d];h instanceof g.PageItem&&c._addPageElement(h)}c.mode()===c.modes.assess&&c.properties()instanceof e.data.ObservableObject&&e.bind(c._container,c.properties())}else if("add"===a.action)for(d=0;d<a.items.length;d++)c._addPageElement(a.items[d]);else if("remove"===a.action)for(d=0;d<a.items.length;d++)c._removePageElement(a.items[d].id);else if("itemchange"===a.action)for(d=0;d<a.items.length;d++){var i=c._container.find(e.format(B,a.items[d].id));i.css(m)!=a.items[d].left+"px,"+a.items[d].top+"px"&&i.css(m,a.items[d].left+"px,"+a.items[d].top+"px"),(i.height()!==a.items[d].height||i.width()!==a.items[d].width)&&(i.height(a.items[d].height),i.width(a.items[d].width),i.trigger(n,{height:a.items[d].height,width:a.items[d].width})),i.css(o)!=a.items[d].rotate&&i.css(o,a.items[d].rotate+"deg")}},items:function(){return this._container.children()},_clear:function(){var a=this;e.unbind(a.element),a.element.find("*").off(),a.element.off().empty().removeClass(A)},destroy:function(){var a=this;f.fn.destroy.call(a),a._clear(),a.setDataSource(j),e.destroy(a.element)}});e.ui.plugin(F)}(jQuery),function(a,b){"use strict";function c(b){return a.type(b)===o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)
}function d(a,b,c,d,e){return a({idx:b,text:c,ns:m.ns,numeric:d,title:e||""})}function e(a,b,c,d){return a({className:b.substring(1),text:c,wrapClassName:d||""})}function f(a,b,c,d){a.find(b).parent().attr(m.attr("index"),c).attr("tabindex",-1).toggleClass("k-state-disabled",d)}function g(a,b){f(a,w,0,0>=b)}function h(a,b){f(a,y,Math.max(0,b-1),0>=b)}function i(a,b,c){f(a,z,Math.min(c-1,b+1),b>=c-1)}function j(a,b,c){f(a,x,c-1,b>=c-1)}var k=Function,l=k("return this")(),m=l.kendo,n=(m.data,m.ui.Widget),o="string",p="number",q=null,r="change",s="click",t="keydown",u=".kendoPlaybar",v="k-widget kj-playbar",w=".k-i-seek-w",x=".k-i-seek-e",y=".k-i-arrow-w",z=".k-i-arrow-e",A=!1,B="kidoju.widgets.playbar: ",C=n.extend({init:function(a,b){var c=this;b=b||{},n.fn.init.call(c,a,b),A&&l.console&&l.console.log(B+"widget initialized"),c._index=c.options.index||0,c._templates(),c._layout(),c._dataSource()},options:{name:"Playbar",iconTemplate:'<a href="\\#" title="#=text#" class="k-link k-pager-nav #= wrapClassName #"><span class="k-icon #= className #">#=text#</span></a>',selectTemplate:'<li><span class="k-state-selected">#=text#</span></li>',linkTemplate:'<li><a tabindex="-1" href="\\#" class="k-link" data-#=ns#index="#=idx#" #if (title !== "") {# title="#=title#" #}#>#=text#</a></li>',buttonCount:10,autoBind:!0,index:0,numeric:!0,info:!0,timer:!0,input:!1,previousNext:!0,refresh:!0,dataSource:b,messages:{empty:"No page to display",page:"Page",of:"of {0}",first:"Go to the first page",previous:"Go to the previous page",next:"Go to the next page",last:"Go to the last page",refresh:"Refresh",morePages:"More pages"}},events:[r],index:function(c){var d=this;if(c===b)return d._index;if(A&&l.console&&l.console.log(B+"index set to "+c),a.type(c)!==p)throw new TypeError;if(0>c||c>0&&c>=d.length())throw new RangeError;if(c!==d._index){d._index=c,d.refresh();var e=d.dataSource.at(d._index);d.trigger(r,{index:c,id:e instanceof kidoju.Page?e[e.idField]:b,value:e})}},id:function(a){var d,e=this;if(a===b)return d=e.dataSource.at(e._index),d instanceof kidoju.Page?d[d.idField]:b;if(!c(a))throw new TypeError;if(d=e.dataSource.get(a),d!==b){var f=e.dataSource.indexOf(d);f>=0&&e.index(f)}},value:function(a){var c=this;if(a===b)return c.dataSource.at(c._index);var d=c.dataSource.indexOf(a);d>=0&&c.index(d)},length:function(){return this.dataSource instanceof kidoju.PageCollectionDataSource?this.dataSource.total():0},_templates:function(){var a=this;a.iconTemplate=m.template(a.options.iconTemplate),a.linkTemplate=m.template(a.options.linkTemplate),a.selectTemplate=m.template(a.options.selectTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof kidoju.PageCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(r,b._refreshHandler),b.options.dataSource!==q&&(b.dataSource=kidoju.PageCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(r,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this,c=b.element,d=b.options,f=b.index(),k=b.length();d.previousNext&&(c.find(w).length||(c.append(e(b.iconTemplate,w,d.messages.first,"k-pager-first")),g(c,f,k)),c.find(y).length||(c.append(e(b.iconTemplate,y,d.messages.previous)),h(c,f,k))),d.numeric&&(b.list=c.find(".k-pager-numbers"),b.list.length||(b.list=a('<ul class="k-pager-numbers k-reset" />').appendTo(c))),d.input&&(c.find(".k-pager-input").length||c.append('<span class="k-pager-input k-label">'+d.messages.page+'<input class="k-textbox">'+m.format(d.messages.of,k)+"</span>"),c.on(t+u,".k-pager-input input",a.proxy(b._keydown,b))),d.previousNext&&(c.find(z).length||(c.append(e(b.iconTemplate,z,d.messages.next)),i(c,f,k)),c.find(x).length||(c.append(e(b.iconTemplate,x,d.messages.last,"k-pager-last")),j(c,f,k))),d.refresh&&(c.find(".k-pager-refresh").length||c.append('<a href="#" class="k-pager-refresh k-link" title="'+d.messages.refresh+'"><span class="k-icon k-i-refresh">'+d.messages.refresh+"</span></a>"),c.on(s+u,".k-pager-refresh",a.proxy(b._refreshClick,b))),d.info&&(c.find(".k-pager-info").length||c.append('<span class="k-pager-info k-label" />')),c.on(s+u,"a",a.proxy(b._indexClick,b)).addClass(v+" k-pager-wrap k-widget"),m.notify(b)},refresh:function(a){var b,c,e=this,f=(e.element,e.options),k=e.index(),l=e.length(),n=0,o="";if(!a||"itemchange"!==a.action){if(f.numeric){for(k>f.buttonCount-1&&(n=k-k%f.buttonCount),c=Math.min(n+f.buttonCount-1,l-1),n>0&&(o+=d(e.linkTemplate,n-1,"...",!1,f.messages.morePages)),b=n;c>=b;b++)o+=d(b===k?e.selectTemplate:e.linkTemplate,b,b+1,!0);l-1>c&&(o+=d(e.linkTemplate,b,"...",!1,f.messages.morePages)),""===o&&(o=e.selectTemplate({text:0})),e.list.html(o)}f.info&&(o=l>0?f.messages.page+" "+(k+1)+" "+m.format(f.messages.of,l):f.messages.empty,e.element.find(".k-pager-info").html(o)),f.input&&e.element.find(".k-pager-input").html(f.messages.page+'<input class="k-textbox">'+m.format(f.messages.of,l)).find("input").val(k+1).attr("disabled",1>l).toggleClass("k-state-disabled",1>l),f.previousNext&&(g(e.element,k,l),h(e.element,k,l),i(e.element,k,l),j(e.element,k,l))}},_keydown:function(a){if(a.keyCode===m.keys.ENTER){var b=this.element.find(".k-pager-input").find("input"),c=parseInt(b.val(),10);(isNaN(c)||1>c||c>this.length())&&(c=this.index()+1),b.val(c),this.index(c-1)}},_refreshClick:function(a){a.preventDefault(),this.dataSource.read()},_indexClick:function(b){var c=a(b.currentTarget);b.preventDefault(),c.is(".k-state-disabled")||this.index(parseInt(c.attr(m.attr("index")),10))},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off().empty().removeClass(v)},destroy:function(){var a=this;n.fn.destroy.call(a),a._clear(),a.setDataSource(q),m.destroy(a.element)}});m.ui.plugin(C)}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=d.ui.Widget,f=c.kidoju,g="string",h="click",i="change",j="k-widget kj-toolbox",k='<img src="{0}" alt="{1}">',l="kj-tool",m="data-tool",n="data-selected",o="active",p="pointer",q=32,r=!1,s="kidoju.widgets.toolbox: ",t=e.extend({init:function(a,b){var d=this;b=b||{},e.fn.init.call(d,a,b),r&&c.console&&c.console.log(s+"widget initialized"),d._layout()},options:{name:"Toolbox",size:q,path:"./styles/images/toolbox/",tools:f.tools},tool:function(b){var d=this;if(!b)return d.options.tools.get(o);if(a.type(b)!==g)throw new TypeError;if(!d.options.tools.hasOwnProperty(b))throw new RangeError;b!==d.options.tool&&(d.options.tools.set(o,b),r&&c.console&&c.console.log(s+"tool changed for "+b))},reset:function(){var a=this;a.tool(p)},_layout:function(){var b=this;b._clear(),a(b.element).addClass(j),a.each(b.options.tools,function(c,e){if(e instanceof f.Tool&&b.options.tools.hasOwnProperty(e.id)){var g=a(d.format(k,b.options.path+e.icon+".svg","TODO: Translate")).attr(m,e.id).addClass(l).height(b.options.size).width(b.options.size);a(b.element).append(g)}}),a(b.element).find("img").on(h,function(c){var d=a(c.target).attr(m);a.type(d)===g&&b.tool(d)}),b.refresh(),a.isFunction(b._refreshHandler)&&b.options.tools.unbind(i,b._refreshHandler),b._refreshHandler=a.proxy(b.refresh,b),b.options.tools.bind(i,b._refreshHandler)},refresh:function(){var b=this;a(b.element).find("["+n+"]").removeProp(n),a(b.element).find("["+m+"="+b.tool()+"]").prop(n,!0)},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off(),a(b.element).empty(),a(b.element).removeClass(j)},destroy:function(){var b=this;e.fn.destroy.call(b),b._clear(),a.isFunction(b._refreshHandler)&&b.options.tools.unbind(i,b._refreshHandler),d.destroy(b.element)}});d.ui.plugin(t)}(jQuery);
//# sourceMappingURL=kidoju.widgets.min.map